(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[         0,          0]
NotebookDataLength[     14828,        392]
NotebookOptionsPosition[     13934,        363]
NotebookOutlinePosition[     14357,        380]
CellTagsIndexPosition[     14314,        377]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Imposta", " ", "la", " ", "cartella", " ", "di", " ", "lavoro"}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"SetDirectory", "[", 
     RowBox[{"NotebookDirectory", "[", "]"}], "]"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "===", "===", "===", "===", "===", "===", "===", "===", "===", "=="}], 
    "*)"}], "\n", 
   RowBox[{"(*", 
    RowBox[{"1.", " ", "Elaborazione", " ", "immagine", " ", "ref"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "===", "===", "===", "===", "===", "===", "===", "===", "===", "=="}], 
    "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"img", "=", 
     RowBox[{"Import", "[", "\"\<foto5.jpg\>\"", "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"img", "=", 
     RowBox[{"ImageResize", "[", 
      RowBox[{"img", ",", 
       RowBox[{"Scaled", "[", "0.5", "]"}]}], "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"imgBin", "=", 
     RowBox[{"Binarize", "[", "img", "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"imgFilt", "=", 
     RowBox[{"GaussianFilter", "[", 
      RowBox[{"imgBin", ",", "1"}], "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"imgEnhanced", "=", 
     RowBox[{"ImageAdjust", "[", "imgFilt", "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"edges", "=", 
     RowBox[{"EdgeDetect", "[", "imgEnhanced", "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"dilatedEdges", "=", 
     RowBox[{"Dilation", "[", 
      RowBox[{"edges", ",", 
       RowBox[{"DiskMatrix", "[", "0", "]"}]}], "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"filledImage", "=", 
     RowBox[{"FillingTransform", "[", "dilatedEdges", "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"componenti", "=", 
     RowBox[{"MorphologicalComponents", "[", "filledImage", "]"}]}], ";"}], 
   "\n", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"misure", "=", 
     RowBox[{"ComponentMeasurements", "[", 
      RowBox[{"componenti", ",", 
       RowBox[{"{", 
        RowBox[{
        "\"\<Centroid\>\"", ",", "\"\<BoundingBox\>\"", ",", 
         "\"\<Orientation\>\"", ",", "\"\<Shape\>\"", ",", "\"\<Area\>\"", 
         ",", "\"\<PerimeterLength\>\"", ",", "\"\<BoundingBoxArea\>\"", ",", 
         "\"\<Eccentricity\>\"", ",", "\"\<Circularity\>\"", ",", 
         "\"\<Rectangularity\>\""}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "Seleziono", " ", "la", " ", "componente", " ", "di", " ", 
      "riferimento"}], ",", 
     RowBox[{"ad", " ", 
      RowBox[{"es", ".", "la"}], " ", "sesta"}]}], "*)"}], "\n", 
   RowBox[{"forma", "=", 
    RowBox[{"misure", "[", 
     RowBox[{"[", "6", "]"}], "]"}]}], "\n", 
   RowBox[{
    RowBox[{"centF", "=", 
     RowBox[{"forma", "[", 
      RowBox[{"[", 
       RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";"}], "    ", 
   RowBox[{"(*", "Centro", "*)"}], "\n", 
   RowBox[{
    RowBox[{"bboxF", "=", 
     RowBox[{"forma", "[", 
      RowBox[{"[", 
       RowBox[{"2", ",", "2"}], "]"}], "]"}]}], ";"}], "    ", 
   RowBox[{"(*", "BoundingBox", "*)"}], "\n", 
   RowBox[{
    RowBox[{"orentF", "=", 
     RowBox[{"forma", "[", 
      RowBox[{"[", 
       RowBox[{"2", ",", "3"}], "]"}], "]"}]}], ";"}], "   ", 
   RowBox[{"(*", "Orientamento", "*)"}], "\n", 
   RowBox[{
    RowBox[{"shapF", "=", 
     RowBox[{"forma", "[", 
      RowBox[{"[", 
       RowBox[{"2", ",", "4"}], "]"}], "]"}]}], ";"}], "    ", 
   RowBox[{"(*", "Shape", "*)"}], "\n", 
   RowBox[{
    RowBox[{"arF", "=", 
     RowBox[{"forma", "[", 
      RowBox[{"[", 
       RowBox[{"2", ",", "5"}], "]"}], "]"}]}], ";"}], "      ", 
   RowBox[{"(*", "Area", "*)"}], "\n", 
   RowBox[{
    RowBox[{"perlenF", "=", 
     RowBox[{"forma", "[", 
      RowBox[{"[", 
       RowBox[{"2", ",", "6"}], "]"}], "]"}]}], ";"}], "  ", 
   RowBox[{"(*", "Perimetro", "*)"}], "\n", 
   RowBox[{
    RowBox[{"bbaF", "=", 
     RowBox[{"forma", "[", 
      RowBox[{"[", 
       RowBox[{"2", ",", "7"}], "]"}], "]"}]}], ";"}], "     ", 
   RowBox[{"(*", 
    RowBox[{"Bounding", " ", "Box", " ", "Area"}], "*)"}], "\n", 
   RowBox[{
    RowBox[{"eccF", "=", 
     RowBox[{"forma", "[", 
      RowBox[{"[", 
       RowBox[{"2", ",", "8"}], "]"}], "]"}]}], ";"}], "     ", 
   RowBox[{"(*", "Eccentricit\[AGrave]", "*)"}], "\n", 
   RowBox[{
    RowBox[{"ciroF", "=", 
     RowBox[{"forma", "[", 
      RowBox[{"[", 
       RowBox[{"2", ",", "9"}], "]"}], "]"}]}], ";"}], "    ", 
   RowBox[{"(*", "Circolarit\[AGrave]", "*)"}], "\n", 
   RowBox[{
    RowBox[{"rettoF", "=", 
     RowBox[{"forma", "[", 
      RowBox[{"[", 
       RowBox[{"2", ",", "10"}], "]"}], "]"}]}], ";"}], "  ", 
   RowBox[{"(*", "Rettangularit\[AGrave]", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.948430860124722*^9, 3.94843087369141*^9}, 
   3.948430925513605*^9, {3.948431458049715*^9, 3.9484314582277393`*^9}, {
   3.9484317897380333`*^9, 3.948431789937223*^9}, {3.948432049827777*^9, 
   3.948432050595971*^9}},
 CellLabel->
  "In[220]:=",ExpressionUUID->"3fdbcaf5-8fa5-4661-9d94-565ceeb90535"],

Cell[BoxData[
 RowBox[{"6", "\[Rule]", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"102.78275240384616`", ",", "381.79236778846155`"}], "}"}], ",", 
    
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"62.`", ",", "346.`"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"143.`", ",", "418.`"}], "}"}]}], "}"}], ",", 
    RowBox[{"-", "2.243900545589176`"}], ",", 
    GraphicsBox[
     TagBox[RasterBox[CompressedData["
1:eJzt2EsKwkAMBuAZV17DW7h1p0vrCVqo7hSqIN7eFhG0TpI/mYgPJtCCZvL9
FO2DzppDtZ2EEI7TflfV50XX1ZfN8GG1P7W7tps3Q3vZb+tAVOyL6pkqRoBE
1jyD/GoodAQy68UFaY+akPocmJgQ2hI4nmGbGPg4xbQ0YJQ7SvA2SH1vAqkq
YAH1IOS5g5884j8BNR4g6jhRVHM8aeIY0uylxQwuRWZyL2K+F9mbbZ7oxd1J
T28Qfb2fKPdjfsPP4io6/7Wdz733Xh2ySe8rYsrLIAnOSjKcSeQ9tShxWhHw
vv9ZqYAFLKAdJGKsIBlkA5koC4hlwaAiDQHVeTwoJ0Ie8r7UAGKpOJgRewXy
ihav
       "], {{0, 72.}, {81., 0}}, {0, 1},
       ColorFunction->GrayLevel],
      BoxForm`ImageTag["Bit", ColorSpace -> Automatic, Interleaving -> None],
      Selectable->False],
     DefaultBaseStyle->"ImageGraphics",
     ImageSizeRaw->{81., 72.},
     PlotRange->{{0, 81.}, {0, 72.}}], ",", "3339.625`", ",", "346", ",", 
    "5832", ",", "0.21769260580903568`", ",", "0.7112556340778438`", ",", 
    "0.5559639158035415`"}], "}"}]}]], "Output",
 CellChangeTimes->{
  3.9484316099368467`*^9, 3.948431708814142*^9, {3.948431787087998*^9, 
   3.948431791086708*^9}, 3.948431990212922*^9, 3.948432051695738*^9, 
   3.948433136971222*^9, 3.948433466285577*^9, 3.948434322249667*^9},
 CellLabel->
  "Out[231]=",ExpressionUUID->"6331e42f-811f-4e1f-b73d-5f8f45373a8d"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"SetDirectory", "[", 
   RowBox[{"NotebookDirectory", "[", "]"}], "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"video", "=", 
   RowBox[{"Import", "[", "\"\<video3.mp4\>\"", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"frames", "=", 
    RowBox[{"VideoExtractFrames", "[", 
     RowBox[{"video", ",", "All"}], "]"}]}], ";"}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"processedFrames", "=", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{"Function", "[", 
       RowBox[{"frame", ",", 
        RowBox[{"Module", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
           "img", ",", "imgBin", ",", "imgFilt", ",", "imgAdj", ",", "edges", 
            ",", "dilatedEdges", ",", "filledImage", ",", "componenti", ",", 
            "misure", ",", "candidati", ",", "shapes"}], "}"}], ",", 
          RowBox[{"(*", 
           RowBox[{"Pre", "-", 
            RowBox[{"elaborazione", " ", "del", " ", "frame"}]}], "*)"}], 
          RowBox[{
           RowBox[{"img", "=", "frame"}], ";", "\[IndentingNewLine]", 
           RowBox[{"imgBin", "=", 
            RowBox[{"Binarize", "[", "img", "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"imgFilt", "=", 
            RowBox[{"GaussianFilter", "[", 
             RowBox[{"imgBin", ",", "1"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"imgAdj", "=", 
            RowBox[{"ImageAdjust", "[", "imgFilt", "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"edges", "=", 
            RowBox[{"EdgeDetect", "[", "imgAdj", "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"dilatedEdges", "=", 
            RowBox[{"Dilation", "[", 
             RowBox[{"edges", ",", 
              RowBox[{"DiskMatrix", "[", "1", "]"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"filledImage", "=", 
            RowBox[{"FillingTransform", "[", "dilatedEdges", "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"componenti", "=", 
            RowBox[{"MorphologicalComponents", "[", "filledImage", "]"}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "Estrae", " ", "le", " ", "propriet\[AGrave]", " ", "per", " ", 
             "ciascun", " ", "componente"}], "*)"}], 
           RowBox[{"misure", "=", 
            RowBox[{"ComponentMeasurements", "[", 
             RowBox[{"componenti", ",", 
              RowBox[{"{", 
               RowBox[{
               "\"\<Centroid\>\"", ",", "\"\<Orientation\>\"", ",", 
                "\"\<Shape\>\"", ",", "\"\<Eccentricity\>\"", ",", 
                "\"\<Circularity\>\"", ",", "\"\<Rectangularity\>\""}], 
               "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "Filtra", " ", "i", " ", "candidati", " ", "confrontando", " ", 
             "i", " ", "parametri", " ", "con", " ", "i", " ", "valori", " ", 
             "di", " ", "riferimento"}], "*)"}], 
           RowBox[{"candidati", "=", 
            RowBox[{"Select", "[", 
             RowBox[{"misure", ",", 
              RowBox[{
               RowBox[{"With", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"ecc", "=", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "4"}], "]"}], "]"}]}], ",", 
                   RowBox[{"ciro", "=", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "5"}], "]"}], "]"}]}], ",", 
                   RowBox[{"retto", "=", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "6"}], "]"}], "]"}]}]}], "}"}], ",", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Abs", "[", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"ecc", "/", "eccF"}], ")"}], "-", "1"}], "]"}], 
                   "<", "0.2"}], "&&", 
                  RowBox[{
                   RowBox[{"Abs", "[", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"ciro", "/", "ciroF"}], ")"}], "-", "1"}], "]"}], 
                   "<", "0.2"}], "&&", 
                  RowBox[{
                   RowBox[{"Abs", "[", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"retto", "/", "rettoF"}], ")"}], "-", "1"}], 
                    "]"}], "<", "0.2"}]}]}], "]"}], "&"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{"Estrae", " ", "il", " ", "contorno", " ", 
             RowBox[{"(", "Shape", ")"}], " ", "dai", " ", "candidati"}], 
            "*)"}], 
           RowBox[{"shapes", "=", 
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{"Function", "[", 
               RowBox[{"candidate", ",", 
                RowBox[{"candidate", "[", 
                 RowBox[{"[", 
                  RowBox[{"2", ",", "3"}], "]"}], "]"}]}], "]"}], ",", 
              "candidati"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"Show", "[", 
            RowBox[{"img", ",", 
             RowBox[{"Graphics", "[", 
              RowBox[{"{", 
               RowBox[{"Green", ",", "Thick", ",", "shapes"}], "}"}], "]"}], 
             ",", 
             RowBox[{"ImageSize", "->", "Large"}]}], "]"}]}]}], "]"}]}], 
       "]"}], ",", "frames"}], "]"}]}], ";"}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Export", "[", 
   RowBox[{"\"\<processed_video.mp4\>\"", ",", "processedFrames", ",", 
    RowBox[{"\"\<FrameRate\>\"", "->", "30"}]}], "]"}], ";"}], "\n"}], "Input",\

 CellChangeTimes->{{3.948433973302902*^9, 3.948433973305688*^9}, {
  3.94843421711749*^9, 3.948434221253254*^9}},
 CellLabel->
  "In[242]:=",ExpressionUUID->"eff04155-e4c1-4bac-b841-1154b41aa7a7"],

Cell[BoxData[
 TemplateBox[{
  "Export", "prpchg", 
   "\"Warning: the output \\!\\(\\*RowBox[{\\\"\\\\\\\"frame \
rate\\\\\\\"\\\"}]\\) changed from \\!\\(\\*RowBox[{\\\"30\\\"}]\\) to \\!\\(\
\\*FractionBox[\\\"15000001\\\", \\\"500000\\\"]\\).\"", 2, 246, 59, 
   19291909825022476852, "Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.9484344833840733`*^9},
 CellLabel->
  "During evaluation of \
In[242]:=",ExpressionUUID->"dc71bb67-dc16-4b79-a887-c0406774688b"]
}, Open  ]]
},
WindowSize->{Full, Full},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
Magnification:>1.7 Inherited,
FrontEndVersion->"14.1 for Mac OS X ARM (64-bit) (July 16, 2024)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"8ff44575-5005-4d6d-8079-57ed41672088"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[422, 15, 5298, 144, 1334, "Input",ExpressionUUID->"3fdbcaf5-8fa5-4661-9d94-565ceeb90535"],
Cell[5723, 161, 1596, 37, 208, "Output",ExpressionUUID->"6331e42f-811f-4e1f-b73d-5f8f45373a8d"]
}, Open  ]],
Cell[CellGroupData[{
Cell[7356, 203, 6070, 144, 1022, "Input",ExpressionUUID->"eff04155-e4c1-4bac-b841-1154b41aa7a7"],
Cell[13429, 349, 489, 11, 57, "Message",ExpressionUUID->"dc71bb67-dc16-4b79-a887-c0406774688b"]
}, Open  ]]
}
]
*)

